<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lazare Trackt - Expense Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-950 min-h-screen transition-colors">
    <div class="max-w-4xl mx-auto p-6">
        <!-- Header -->
        <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-6">
                <div class="flex items-center gap-3">
                    <i data-lucide="shopping-cart" class="w-6 h-6 text-gray-900 dark:text-white"></i>
                    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">Lazare Trackt</h1>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="app.showExportMenu()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <i data-lucide="download" class="w-5 h-5"></i>
                    </button>
                    <button onclick="document.getElementById('csvInput').click()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <i data-lucide="upload" class="w-5 h-5"></i>
                    </button>
                    <button onclick="app.toggleTheme()" class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors">
                        <i data-lucide="moon" id="themeIcon" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
            <input type="file" id="csvInput" accept=".csv" class="hidden" onchange="app.importCSV(event)">

            <!-- Budget Alert -->
            <div id="budgetAlert" class="hidden mb-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg">
                <div class="flex items-center gap-2 text-yellow-800 dark:text-yellow-200">
                    <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                    <span class="text-sm font-medium" id="budgetAlertText"></span>
                </div>
            </div>

            <!-- Stats -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                    <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">Monthly Recurring</div>
                    <div class="text-2xl font-semibold text-gray-900 dark:text-white" id="monthlyTotal">$0.00</div>
                </div>
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                    <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">Yearly Total</div>
                    <div class="text-2xl font-semibold text-gray-900 dark:text-white" id="yearlyTotal">$0.00</div>
                </div>
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                    <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">One-Time Total</div>
                    <div class="text-2xl font-semibold text-gray-900 dark:text-white" id="oneTimeTotal">$0.00</div>
                </div>
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
                    <div class="text-sm text-gray-500 dark:text-gray-400 mb-1">Total Items</div>
                    <div class="text-2xl font-semibold text-gray-900 dark:text-white" id="itemCount">0</div>
                </div>
            </div>

            <!-- Budget Setter -->
            <div class="flex items-center gap-3">
                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">Monthly Budget:</label>
                <input type="number" id="budgetInput" placeholder="Set budget" step="0.01"
                    onchange="app.setBudget()"
                    class="flex-1 px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                <span class="text-sm text-gray-600 dark:text-gray-400" id="budgetRemaining"></span>
            </div>
        </div>

        <!-- Add Item Button -->
        <button onclick="app.toggleForm()" class="w-full bg-black dark:bg-white text-white dark:text-black py-3 px-4 rounded-lg font-medium mb-6 hover:bg-gray-800 dark:hover:bg-gray-100 transition-colors flex items-center justify-center gap-2">
            <i data-lucide="plus" class="w-5 h-5"></i>
            Add Item
        </button>

        <!-- Search and Filter -->
        <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-3">
                <input type="text" id="searchInput" placeholder="Search items..." oninput="app.applyFilters()"
                    class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                <select id="categoryFilter" onchange="app.applyFilters()" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                    <option value="">All Categories</option>
                    <option>Entertainment</option>
                    <option>Health</option>
                    <option>Food</option>
                    <option>Utilities</option>
                    <option>Shopping</option>
                    <option>Other</option>
                </select>
                <select id="sortBy" onchange="app.applyFilters()" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                    <option value="name">Sort by Name</option>
                    <option value="amount-high">Amount (High to Low)</option>
                    <option value="amount-low">Amount (Low to High)</option>
                    <option value="day">Day of Month</option>
                </select>
            </div>
        </div>

        <!-- Category Chart -->
        <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-6 mb-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Spending by Category</h2>
                <div class="flex gap-2">
                    <button onclick="app.setChartType('bar')" id="barChartBtn" class="px-3 py-1 text-sm bg-black dark:bg-white text-white dark:text-black rounded">Bar</button>
                    <button onclick="app.setChartType('pie')" id="pieChartBtn" class="px-3 py-1 text-sm bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded">Pie</button>
                </div>
            </div>
            <canvas id="categoryChart" height="200"></canvas>
        </div>

        <!-- Dashboard Widgets -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-6">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Top 5 Most Expensive</h2>
                <div id="topExpensiveItems" class="space-y-3"></div>
            </div>
            <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-6">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">Next Month Forecast</h2>
                <div class="space-y-3">
                    <div class="flex justify-between"><span class="text-sm text-gray-600 dark:text-gray-400">Recurring Charges</span><span id="forecastRecurring" class="font-semibold">$0.00</span></div>
                    <div class="flex justify-between"><span class="text-sm text-gray-600 dark:text-gray-400">Predicted One-Time (avg)</span><span id="forecastOneTime" class="font-semibold">$0.00</span></div>
                    <div class="pt-3 border-t border-gray-200 dark:border-gray-700">
                        <div class="flex justify-between"><span class="font-medium">Total Forecast</span><span id="forecastTotal" class="text-xl font-bold">$0.00</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Menu -->
        <div id="exportMenu" class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-6 hidden">
            <h3 class="text-sm font-semibold text-gray-900 dark:text-white mb-3">Export Data</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                <button onclick="app.exportCSV()" class="flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                    <i data-lucide="file-text" class="w-4 h-4"></i><span class="text-sm">CSV</span>
                </button>
                <button onclick="app.exportJSON()" class="flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                    <i data-lucide="code" class="w-4 h-4"></i><span class="text-sm">JSON</span>
                </button>
                <button onclick="app.exportPDF('monthly')" class="flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                    <i data-lucide="file-text" class="w-4 h-4"></i><span class="text-sm">Monthly PDF</span>
                </button>
                <button onclick="app.exportPDF('yearly')" class="flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                    <i data-lucide="file-text" class="w-4 h-4"></i><span class="text-sm">Yearly PDF</span>
                </button>
            </div>
            <div class="mt-3 pt-3 border-t border-gray-200 dark:border-gray-700">
                <button onclick="document.getElementById('jsonInput').click()" class="w-full flex items-center justify-center gap-2 px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 text-gray-700 dark:text-gray-300">
                    <i data-lucide="upload" class="w-4 h-4"></i><span class="text-sm">Import JSON Backup</span>
                </button>
            </div>
        </div>
        <input type="file" id="jsonInput" accept=".json" class="hidden" onchange="app.importJSON(event)">

        <!-- Add/Edit Form -->
        <div id="addForm" class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg p-6 mb-6 hidden">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4" id="formTitle">Add New Item</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Item Name</label>
                    <input type="text" id="itemName" placeholder="e.g., Netflix" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Amount</label>
                        <input type="number" id="itemAmount" placeholder="0.00" step="0.01" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Category</label>
                        <select id="itemCategory" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                            <option>Entertainment</option>
                            <option>Health</option>
                            <option>Food</option>
                            <option>Utilities</option>
                            <option>Shopping</option>
                            <option>Other</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Type</label>
                    <select id="itemType" onchange="app.toggleDaySelector()" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white bg-white dark:bg-gray-800 text-gray-900 dark:text-white">
                        <option value="recurring">Recurring (Monthly)</option>
                        <option value="one-time">One-Time Purchase</option>
                    </select>
                </div>
                <div id="daySelector" class="">
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Day of Month</label>
                    <select id="itemDay" class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-black dark:focus:ring-white bg-white dark:bg-gray-800 text-gray-900 dark:text-white"></select>
                </div>
                <div class="flex gap-3 pt-2">
                    <button onclick="app.saveItem()" id="saveBtn" class="flex-1 bg-black dark:bg-white text-white dark:text-black py-2 px-4 rounded-lg font-medium hover:bg-gray-800 dark:hover:bg-gray-100">Add Item</button>
                    <button onclick="app.cancelForm()" class="flex-1 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 py-2 px-4 rounded-lg font-medium border border-gray-300 dark:border-gray-600 hover:bg-gray-300 dark:hover:bg-gray-600">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Tabs & Items List -->
        <div class="bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg mb-6">
            <div class="flex border-b border-gray-200 dark:border-gray-700">
                <button onclick="app.switchTab('recurring')" id="tabRecurring" class="flex-1 py-3 px-4 font-medium text-gray-900 dark:text-white border-b-2 border-black dark:border-white">Recurring</button>
                <button onclick="app.switchTab('one-time')" id="tabOneTime" class="flex-1 py-3 px-4 font-medium text-gray-500 dark:text-gray-400 border-b-2 border-transparent hover:text-gray-900 dark:hover:text-white">One-Time</button>
            </div>
            <div id="itemsList" class="p-6"></div>
        </div>
    </div>

    <script>
        const app = {
            items: [
                { id: 1, name: 'Netflix', amount: 15.99, category: 'Entertainment', type: 'recurring', dayOfMonth: 1 },
                { id: 2, name: 'Spotify', amount: 9.99, category: 'Entertainment', type: 'recurring', dayOfMonth: 5 },
                { id: 3, name: 'Laptop', amount: 1299.00, category: 'Shopping', type: 'one-time' },
                { id: 4, name: 'Gym Membership', amount: 45.00, category: 'Health', type: 'recurring', dayOfMonth: 15 }
            ],
            currentTab: 'recurring',
            theme: localStorage.getItem('theme') || 'light',
            budget: parseFloat(localStorage.getItem('budget')) || null,
            editingId: null,
            chart: null,
            chartType: 'bar',

            init() {
                this.applyTheme();
                if (this.budget) document.getElementById('budgetInput').value = this.budget;

                const daySelect = document.getElementById('itemDay');
                for (let i = 1; i <= 31; i++) {
                    const opt = document.createElement('option');
                    opt.value = i;
                    opt.textContent = `Day ${i}`;
                    daySelect.appendChild(opt);
                }

                this.render();
                this.updateChart();
                this.updateDashboard();
                lucide.createIcons();
            },

            applyTheme() {
                if (this.theme === 'dark') {
                    document.documentElement.classList.add('dark');
                    document.body.classList.replace('bg-gray-50', 'bg-gray-950');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.body.classList.replace('bg-gray-950', 'bg-gray-50');
                }
                const icon = document.getElementById('themeIcon');
                icon.setAttribute('data-lucide', this.theme === 'light' ? 'moon' : 'sun');
                localStorage.setItem('theme', this.theme);
                lucide.createIcons();
            },

            toggleTheme() {
                this.theme = this.theme === 'light' ? 'dark' : 'light';
                this.applyTheme();
                if (this.chart) this.updateChart();
            },

            toggleForm() {
                const form = document.getElementById('addForm');
                form.classList.toggle('hidden');
                if (form.classList.contains('hidden')) {
                    this.editingId = null;
                } else {
                    this.clearForm();
                    document.getElementById('formTitle').textContent = 'Add New Item';
                    document.getElementById('saveBtn').textContent = 'Add Item';
                }
                document.getElementById('exportMenu').classList.add('hidden');
            },

            clearForm() {
                document.getElementById('itemName').value = '';
                document.getElementById('itemAmount').value = '';
                document.getElementById('itemCategory').value = 'Entertainment';
                document.getElementById('itemType').value = 'recurring';
                document.getElementById('itemDay').value = 1;
                this.toggleDaySelector();
            },

            toggleDaySelector() {
                const isRecurring = document.getElementById('itemType').value === 'recurring';
                document.getElementById('daySelector').classList.toggle('hidden', !isRecurring);
            },

            cancelForm() {
                this.toggleForm();
            },

            saveItem() {
                const name = document.getElementById('itemName').value.trim();
                const amount = parseFloat(document.getElementById('itemAmount').value);
                const category = document.getElementById('itemCategory').value;
                const type = document.getElementById('itemType').value;
                const dayOfMonth = type === 'recurring' ? parseInt(document.getElementById('itemDay').value) : null;

                if (!name || isNaN(amount) || amount <= 0) {
                    alert('Please enter a valid name and amount.');
                    return;
                }

                if (this.editingId) {
                    const item = this.items.find(i => i.id === this.editingId);
                    if (item) {
                        item.name = name;
                        item.amount = amount;
                        item.category = category;
                        item.type = type;
                        item.dayOfMonth = dayOfMonth;
                    }
                } else {
                    this.items.push({
                        id: Date.now(),
                        name, amount, category, type, dayOfMonth
                    });
                }

                this.toggleForm();
                this.render();
                this.updateChart();
                this.updateDashboard();
                this.checkBudgetAlert();
                lucide.createIcons();
            },

            deleteItem(id) {
                if (confirm('Delete this item?')) {
                    this.items = this.items.filter(item => item.id !== id);
                    this.render();
                    this.updateChart();
                    this.updateDashboard();
                    this.checkBudgetAlert();
                }
            },

            setBudget() {
                const val = parseFloat(document.getElementById('budgetInput').value);
                this.budget = isNaN(val) || val <= 0 ? null : val;
                localStorage.setItem('budget', this.budget);
                this.checkBudgetAlert();
            },

            checkBudgetAlert() {
                const monthly = this.items.filter(i => i.type === 'recurring').reduce((s, i) => s + i.amount, 0);
                const alert = document.getElementById('budgetAlert');
                const text = document.getElementById('budgetAlertText');
                const remaining = document.getElementById('budgetRemaining');

                if (this.budget && monthly > 0) {
                    const diff = this.budget - monthly;
                    remaining.textContent = diff >= 0 ? `($${diff.toFixed(2)} remaining)` : `($${Math.abs(diff).toFixed(2)} over)`;
                    if (monthly >= this.budget) {
                        text.textContent = 'You have exceeded your monthly budget!';
                        alert.classList.remove('hidden');
                    } else if (monthly >= this.budget * 0.9) {
                        text.textContent = 'You are close to your budget limit!';
                        alert.classList.remove('hidden');
                    } else {
                        alert.classList.add('hidden');
                    }
                } else {
                    remaining.textContent = '';
                    alert.classList.add('hidden');
                }
            },

            switchTab(tab) {
                this.currentTab = tab;
                document.getElementById('tabRecurring').classList.toggle('text-gray-900', tab === 'recurring');
                document.getElementById('tabRecurring').classList.toggle('text-gray-500', tab !== 'recurring');
                document.getElementById('tabRecurring').classList.toggle('dark:text-white', tab === 'recurring');
                document.getElementById('tabRecurring').classList.toggle('dark:text-gray-400', tab !== 'recurring');
                document.getElementById('tabRecurring').classList.toggle('border-black', tab === 'recurring');
                document.getElementById('tabRecurring').classList.toggle('dark:border-white', tab === 'recurring');
                document.getElementById('tabRecurring').classList.toggle('border-transparent', tab !== 'recurring');

                document.getElementById('tabOneTime').classList.toggle('text-gray-900', tab === 'one-time');
                document.getElementById('tabOneTime').classList.toggle('text-gray-500', tab !== 'one-time');
                document.getElementById('tabOneTime').classList.toggle('dark:text-white', tab === 'one-time');
                document.getElementById('tabOneTime').classList.toggle('dark:text-gray-400', tab !== 'one-time');
                document.getElementById('tabOneTime').classList.toggle('border-black', tab === 'one-time');
                document.getElementById('tabOneTime').classList.toggle('dark:border-white', tab === 'one-time');
                document.getElementById('tabOneTime').classList.toggle('border-transparent', tab !== 'one-time');

                this.render();
            },

            applyFilters() {
                if (this.filterTimeout) clearTimeout(this.filterTimeout);
                this.filterTimeout = setTimeout(() => this.render(), 200);
            },

            render() {
                const search = document.getElementById('searchInput').value.toLowerCase();
                const catFilter = document.getElementById('categoryFilter').value;
                const sortBy = document.getElementById('sortBy').value;

                let filtered = this.items.filter(item => {
                    if (item.type !== this.currentTab) return false;
                    if (search && !item.name.toLowerCase().includes(search)) return false;
                    if (catFilter && item.category !== catFilter) return false;
                    return true;
                });

                if (sortBy === 'name') filtered.sort((a, b) => a.name.localeCompare(b.name));
                else if (sortBy === 'amount-high') filtered.sort((a, b) => b.amount - a.amount);
                else if (sortBy === 'amount-low') filtered.sort((a, b) => a.amount - b.amount);
                else if (sortBy === 'day' && this.currentTab === 'recurring') filtered.sort((a, b) => (a.dayOfMonth || 0) - (b.dayOfMonth || 0));

                const monthly = this.items.filter(i => i.type === 'recurring').reduce((s, i) => s + i.amount, 0);
                const oneTime = this.items.filter(i => i.type === 'one-time').reduce((s, i) => s + i.amount, 0);

                document.getElementById('monthlyTotal').textContent = `$${monthly.toFixed(2)}`;
                document.getElementById('yearlyTotal').textContent = `$${(monthly * 12).toFixed(2)}`;
                document.getElementById('oneTimeTotal').textContent = `$${oneTime.toFixed(2)}`;
                document.getElementById('itemCount').textContent = this.items.length;

                const listHTML = filtered.length === 0
                    ? `<div class="text-center py-12 text-gray-500"><i data-lucide="inbox" class="w-12 h-12 mx-auto mb-4"></i><p>No items yet</p></div>`
                    : filtered.map(item => `
                        <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 mb-4 hover:bg-gray-50 dark:hover:bg-gray-800">
                            <div class="flex justify-between items-start">
                                <div>
                                    <div class="font-semibold">${item.name}</div>
                                    <div class="text-sm text-gray-600 dark:text-gray-400 mt-1">
                                        $${item.amount.toFixed(2)} • ${item.category}
                                        ${item.type === 'recurring' ? `• Day ${item.dayOfMonth} • $${(item.amount*12).toFixed(2)}/year` : ''}
                                    </div>
                                </div>
                                <button onclick="app.deleteItem(${item.id})" class="text-red-600 hover:text-red-800 p-1">
                                    <i data-lucide="trash-2" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    `).join('');

                document.getElementById('itemsList').innerHTML = listHTML;
                lucide.createIcons();
            },

            updateChart() {
                const totals = {};
                this.items.forEach(item => {
                    totals[item.category] = (totals[item.category] || 0) + item.amount;
                });
                const labels = Object.keys(totals);
                const data = Object.values(totals);
                const isDark = this.theme === 'dark';

                if (this.chart) this.chart.destroy();

                this.chart = new Chart(document.getElementById('categoryChart'), {
                    type: this.chartType,
                    data: {
                        labels,
                        datasets: [{
                            data,
                            backgroundColor: isDark
                                ? ['#60a5fa', '#34d399', '#fbbf24', '#f87171', '#a78bfa', '#f472b6']
                                : ['#2563eb', '#16a34a', '#ca8a04', '#dc2626', '#7c3aed', '#ec4899']
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { position: 'bottom' } }
                    }
                });
            },

            updateDashboard() {
                // Top 5 expensive
                const top5 = [...this.items].sort((a, b) => b.amount - a.amount).slice(0, 5);
                document.getElementById('topExpensiveItems').innerHTML = top5.map(item => `
                    <div class="flex justify-between text-sm">
                        <span>${item.name}</span>
                        <span class="font-semibold">$${item.amount.toFixed(2)}</span>
                    </div>
                `).join('') || '<p class="text-gray-500">No items yet</p>';

                // Forecast
                const recurring = this.items.filter(i => i.type === 'recurring').reduce((s, i) => s + i.amount, 0);
                const oneTimeAvg = this.items.filter(i => i.type === 'one-time').length > 0
                    ? this.items.filter(i => i.type === 'one-time').reduce((s, i) => s + i.amount, 0)
                    : 0;

                document.getElementById('forecastRecurring').textContent = `$${recurring.toFixed(2)}`;
                document.getElementById('forecastOneTime').textContent = `~$${oneTimeAvg.toFixed(2)}`;
                document.getElementById('forecastTotal').textContent = `$${ (recurring + oneTimeAvg).toFixed(2) }`;
            },

            setChartType(type) {
                this.chartType = type;
                document.getElementById('barChartBtn').classList.toggle('bg-black', type === 'bar');
                document.getElementById('barChartBtn').classList.toggle('dark:bg-white', type === 'bar');
                document.getElementById('barChartBtn').classList.toggle('bg-gray-200', type !== 'bar');
                document.getElementById('barChartBtn').classList.toggle('dark:bg-gray-700', type !== 'bar');
                document.getElementById('pieChartBtn').classList.toggle('bg-black', type === 'pie');
                document.getElementById('pieChartBtn').classList.toggle('dark:bg-white', type === 'pie');
                document.getElementById('pieChartBtn').classList.toggle('bg-gray-200', type !== 'pie');
                document.getElementById('pieChartBtn').classList.toggle('dark:bg-gray-700', type !== 'pie');
                this.updateChart();
            },

            showExportMenu() {
                document.getElementById('exportMenu').classList.toggle('hidden');
                document.getElementById('addForm').classList.add('hidden');
            },

            exportCSV() {
                const headers = ['Name', 'Amount', 'Category', 'Type', 'Day of Month'];
                const rows = this.items.map(i => [
                    i.name,
                    i.amount,
                    i.category,
                    i.type,
                    i.dayOfMonth || ''
                ]);
                let csv = headers.join(',') + '\n' + rows.map(r => r.map(c => `"${c}"`).join(',')).join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `lazare-trackt-${new Date().toISOString().slice(0,10)}.csv`;
                a.click();
                URL.revokeObjectURL(url);
                this.showExportMenu();
            },

            importCSV(e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = ev => {
                    const lines = ev.target.result.split('\n');
                    for (let i = 1; i < lines.length; i++) {
                        const cols = lines[i].split(',').map(c => c.replace(/^"|"$/g, '').trim());
                        if (cols.length < 4) continue;
                        this.items.push({
                            id: Date.now() + i,
                            name: cols[0],
                            amount: parseFloat(cols[1]),
                            category: cols[2],
                            type: cols[3],
                            dayOfMonth: cols[4] ? parseInt(cols[4]) : null
                        });
                    }
                    this.render();
                    this.updateChart();
                    this.updateDashboard();
                    this.checkBudgetAlert();
                    alert('CSV imported!');
                };
                reader.readAsText(file);
                e.target.value = '';
            },

            exportJSON() {
                const data = { budget: this.budget, items: this.items };
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `lazare-trackt-backup-${new Date().toISOString().slice(0,10)}.json`;
                a.click();
                URL.revokeObjectURL(url);
                this.showExportMenu();
            },

            importJSON(e) {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = ev => {
                    try {
                        const data = JSON.parse(ev.target.result);
                        if (confirm('Replace all data? (Cancel to merge)')) {
                            this.items = data.items || [];
                            this.budget = data.budget || null;
                            if (this.budget) document.getElementById('budgetInput').value = this.budget;
                        } else {
                            this.items.push(...(data.items || []).map(i => ({...i, id: Date.now() + Math.random()})));
                        }
                        localStorage.setItem('budget', this.budget);
                        this.render();
                        this.updateChart();
                        this.updateDashboard();
                        this.checkBudgetAlert();
                        alert('JSON imported!');
                    } catch (err) {
                        alert('Invalid JSON file');
                    }
                };
                reader.readAsText(file);
                e.target.value = '';
            },

            exportPDF(period) {
                // Simplified PDF export via print window
                const recurring = this.items.filter(i => i.type === 'recurring');
                const oneTime = this.items.filter(i => i.type === 'one-time');
                const monthlyTotal = recurring.reduce((s, i) => s + i.amount, 0);
                const total = period === 'yearly' ? monthlyTotal * 12 + oneTime.reduce((s, i) => s + i.amount, 0) : monthlyTotal + oneTime.reduce((s, i) => s + i.amount, 0);

                const win = window.open('', '_blank');
                win.document.write(`
                    <html><head><title>Lazare Trackt Report</title>
                    <style>body{font-family:Arial,sans-serif;padding:40px;} table{width:100%;border-collapse:collapse;margin:20px 0;} th,td{border:1px solid #ccc;padding:8px;text-align:left;} th{background:#f0f0f0;}</style>
                    </head><body>
                    <h1>Lazare Trackt - ${period === 'yearly' ? 'Yearly' : 'Monthly'} Report</h1>
                    <p>Generated on ${new Date().toLocaleDateString()}</p>
                    <h2>Summary</h2>
                    <p>Total Recurring (monthly): $${monthlyTotal.toFixed(2)}</p>
                    <p>Total One-Time: $${oneTime.reduce((s,i)=>s+i.amount,0).toFixed(2)}</p>
                    <p><strong>Grand Total: $${total.toFixed(2)}</strong></p>
                    ${recurring.length ? '<h2>Recurring Items</h2>' + recurring.map(i => `<p>${i.name} - $${i.amount} (Day ${i.dayOfMonth})</p>`).join('') : ''}
                    ${oneTime.length ? '<h2>One-Time Items</h2>' + oneTime.map(i => `<p>${i.name} - $${i.amount}</p>`).join('') : ''}
                    </body></html>
                `);
                win.document.close();
                setTimeout(() => win.print(), 500);
                this.showExportMenu();
            }
        };

        app.init();
    </script>
</body>
</html>
